<header class="app-header">
  <!-- MOBILE HEADER -->
  <div class="mobile-header" *ngIf="isMobile()">
    <button class="mobile-menu-btn" (click)="toggleMobileMenu()" *ngIf="auth.isLogged()">
      <span class="hamburger-icon">â˜°</span>
    </button>
    <div class="brand">
      <img src="/miauMarket.png" alt="Logo MiauMarket" class="brand-logo" data-brand="logo" />
    </div>
    <div class="mobile-header-actions" *ngIf="auth.isLogged()">
      <a class="cart-link-mobile" routerLink="/cart">
        ğŸ›’
        <span class="cart-badge-mobile" *ngIf="auth.cartCount() > 0">{{ auth.cartCount() }}</span>
      </a>
      <app-notifications-bell></app-notifications-bell>
    </div>
    <!-- Botones de Login/Register cuando NO estÃ¡ logueado -->
    <div class="mobile-header-actions" *ngIf="!auth.isLogged()">
      <a class="mobile-nav-btn" routerLink="/login">Iniciar sesiÃ³n</a>
      <a class="mobile-nav-btn primary" routerLink="/register">Registrarse</a>
    </div>
  </div>

  <!-- MOBILE MENU OVERLAY -->
  <div *ngIf="showMobileMenu()" class="mobile-menu-overlay" (click)="closeMobileMenu()">
    <div class="mobile-menu" (click)="$event.stopPropagation()">
      <div class="mobile-menu-header">
        <h2>MenÃº</h2>
        <button class="close-btn" (click)="closeMobileMenu()">âœ•</button>
      </div>
      
      <div class="mobile-user-info" *ngIf="auth.isLogged()">
        <div class="user-avatar">{{ auth.user()?.name?.charAt(0) }}{{ auth.user()?.Apellido?.charAt(0) }}</div>
        <div class="user-details">
          <span class="user-name">{{ auth.user()?.name }} {{ auth.user()?.Apellido }}</span>
          <span class="user-email">{{ auth.user()?.email }}</span>
        </div>
      </div>
      
      <div class="mobile-menu-items">
        <a class="mobile-menu-item" routerLink="/shop" (click)="closeMobileMenu()">
          <span class="item-icon">ğŸª</span>
          <span class="item-text">Tienda</span>
        </a>
        
        <a class="mobile-menu-item" routerLink="/cart" (click)="closeMobileMenu()">
          <span class="item-icon">ğŸ›’</span>
          <span class="item-text">Carrito</span>
          <span class="item-badge" *ngIf="auth.cartCount() > 0">{{ auth.cartCount() }}</span>
        </a>
        
        <a class="mobile-menu-item" routerLink="/my-orders" (click)="closeMobileMenu()">
          <span class="item-icon">ğŸ“¦</span>
          <span class="item-text">Mis Pedidos</span>
        </a>
        
        <a class="mobile-menu-item" routerLink="/profile" (click)="closeMobileMenu()">
          <span class="item-icon">ğŸ‘¤</span>
          <span class="item-text">Mi Perfil</span>
        </a>
        
        <a *ngIf="auth.user()?.is_staff" class="mobile-menu-item admin-item" routerLink="/admin" (click)="closeMobileMenu()">
          <span class="item-icon">âš™ï¸</span>
          <span class="item-text">AdministraciÃ³n</span>
        </a>
        
        <div class="mobile-menu-divider"></div>
        
        <button class="mobile-menu-item" (click)="toggleTheme()">
          <span class="item-icon">ğŸŒ“</span>
          <span class="item-text">Cambiar Tema</span>
        </button>
        
        <button class="mobile-menu-item logout-item" (click)="logout(); closeMobileMenu()">
          <span class="item-icon">ğŸšª</span>
          <span class="item-text">Cerrar SesiÃ³n</span>
        </button>
      </div>
    </div>
  </div>

  <!-- DESKTOP HEADER -->
  <div class="desktop-header" *ngIf="!isMobile()">
    <div class="header-left">
      <div class="brand">
        <img src="/miauMarket.png" alt="Logo MiauMarket" class="brand-logo" data-brand="logo" />
      </div>

      <!-- Usuario y cerrar sesiÃ³n a la izquierda cuando estÃ¡ logueado -->
      <ng-container *ngIf="auth.isLogged()">
        <a routerLink="/profile" class="user-name user-name-link" routerLinkActive="user-name-active">
          ğŸ‘¤ {{ auth.user()?.name }} {{ auth.user()?.Apellido }}
        </a>
        <button class="btn btn-ghost" (click)="logout()">Cerrar sesiÃ³n</button>
      </ng-container>
      
      <!-- NavegaciÃ³n cuando NO estÃ¡ logueado -->
      <ng-container *ngIf="!auth.isLogged()">
        <a class="nav-link" routerLink="/login" routerLinkActive="active">Iniciar sesiÃ³n</a>
        <a class="nav-link" routerLink="/register" routerLinkActive="active">Registrarse</a>
      </ng-container>
    </div>

    <div class="header-center">
      <div class="header-search" *ngIf="auth.isLogged() && showSearch()">
        <input class="input" placeholder="Buscar productos..." [value]="auth.search()" (input)="auth.search.set($any($event.target).value)" />
      </div>
    </div>

    <div class="header-right">
      <!-- Tienda y Carrito a la derecha cuando estÃ¡ logueado -->
      <ng-container *ngIf="auth.isLogged()">
        <a class="nav-link" routerLink="/shop" routerLinkActive="active">Tienda</a>
        <a class="nav-link" routerLink="/my-orders" routerLinkActive="active">Mis Pedidos</a>
        <a class="nav-link cart-link" routerLink="/cart" routerLinkActive="active">
          Carrito
          <span class="cart-badge" *ngIf="auth.cartCount() > 0">{{ auth.cartCount() }}</span>
        </a>
        <!-- Campana de notificaciones -->
        <app-notifications-bell></app-notifications-bell>
        <!-- BotÃ³n de AdministraciÃ³n solo para admins -->
        <a class="nav-link admin-link" routerLink="/admin" routerLinkActive="active" *ngIf="auth.user()?.is_staff">
          AdministraciÃ³n
        </a>
      </ng-container>
      
      <!-- BotÃ³n de tema siempre visible -->
      <button class="btn btn-ghost theme-toggle" type="button" (click)="toggleTheme()" title="Cambiar tema">
        ğŸŒ“ <span class="sr-only">Alternar modo oscuro</span>
      </button>
    </div>
  </div>
</header>

<main class="app-main">
  <router-outlet />
  <!-- El contenido de login/register aparece aquÃ­ -->
</main>

<!-- Chatbot flotante global (oculto en admin) -->
<mm-chatbot *ngIf="auth.isLogged() && !isAdminPage()"></mm-chatbot>
