<div class="dashboard-container">
  <!-- Header -->
  <header class="dashboard-header">
    <h1>üìä Dashboard de Estad√≠sticas</h1>
    <button class="btn-volver" (click)="volverAAdmin()">
      ‚Üê Volver a Administraci√≥n
    </button>
  </header>

  <!-- Loading -->
  <div *ngIf="loading()" class="loading-state">
    <div class="spinner"></div>
    <p>Cargando estad√≠sticas...</p>
  </div>

  <!-- Contenido principal -->
  <div *ngIf="!loading()" class="dashboard-content">
    
    <!-- Tarjetas de resumen -->
    <section class="stats-cards">
      <div class="stat-card stat-primary">
        <div class="stat-icon">üí∞</div>
        <div class="stat-info">
          <h3>Ingresos Totales</h3>
          <p class="stat-value">{{ formatearMoneda(ingresosTotales()) }}</p>
        </div>
      </div>

      <div class="stat-card stat-success">
        <div class="stat-icon">üõçÔ∏è</div>
        <div class="stat-info">
          <h3>Total Pedidos</h3>
          <p class="stat-value">{{ totalPedidos() }}</p>
        </div>
      </div>

      <div class="stat-card stat-warning">
        <div class="stat-icon">üì¶</div>
        <div class="stat-info">
          <h3>Total Productos</h3>
          <p class="stat-value">{{ totalProductos() }}</p>
        </div>
      </div>

      <div class="stat-card stat-info">
        <div class="stat-icon">üë•</div>
        <div class="stat-info">
          <h3>Usuarios</h3>
          <p class="stat-value">{{ totalUsuarios() }}</p>
        </div>
      </div>

      <div class="stat-card stat-secondary">
        <div class="stat-icon">üßæ</div>
        <div class="stat-info">
          <h3>Ticket Promedio</h3>
          <p class="stat-value">{{ formatearMoneda(ticketPromedio()) }}</p>
        </div>
      </div>

      <div class="stat-card stat-danger">
        <div class="stat-icon">‚ö†Ô∏è</div>
        <div class="stat-info">
          <h3>Stock Bajo</h3>
          <p class="stat-value">{{ productosStockBajo().length }}</p>
          <small>Menos de 10 unidades</small>
        </div>
      </div>
    </section>

    <!-- Estados de pedidos -->
    <section class="pedidos-estado">
      <h2>üìã Resumen de Pedidos por Estado</h2>
      <div class="estado-cards">
        <div class="estado-card pendiente">
          <div class="estado-icon">‚è≥</div>
          <span class="badge">Pendientes</span>
          <p class="count">{{ pedidosPendientes() }}</p>
          <span class="porcentaje">{{ totalPedidos() > 0 ? ((pedidosPendientes() / totalPedidos()) * 100).toFixed(1) : 0 }}%</span>
        </div>
        <div class="estado-card enviado">
          <div class="estado-icon">üöö</div>
          <span class="badge">Enviados</span>
          <p class="count">{{ pedidosEnviados() }}</p>
          <span class="porcentaje">{{ totalPedidos() > 0 ? ((pedidosEnviados() / totalPedidos()) * 100).toFixed(1) : 0 }}%</span>
        </div>
        <div class="estado-card entregado">
          <div class="estado-icon">‚úÖ</div>
          <span class="badge">Entregados</span>
          <p class="count">{{ pedidosEntregados() }}</p>
          <span class="porcentaje">{{ totalPedidos() > 0 ? ((pedidosEntregados() / totalPedidos()) * 100).toFixed(1) : 0 }}%</span>
        </div>
      </div>
    </section>

    <!-- Gr√°ficos y tablas -->
    <div class="dashboard-grid">
      
      <!-- Gr√°fico de Ventas por Mes -->
      <section class="chart-section full-width">
        <h2>üìà Ventas por Mes (√öltimos 6 meses)</h2>
        <div class="chart-container">
          <canvas #ventasChart></canvas>
        </div>
        <div *ngIf="ventasPorMes().length === 0" class="empty-state">
          No hay datos de ventas disponibles
        </div>
      </section>

      <!-- Gr√°fico de Estados de Pedidos -->
      <section class="chart-section">
        <h2>üìã Estado de Pedidos</h2>
        <div class="chart-container chart-medium">
          <canvas #estadosPedidosChart></canvas>
        </div>
      </section>

      <!-- Gr√°fico de Productos por Categor√≠a -->
      <section class="chart-section">
        <h2>üè∑Ô∏è Productos por Categor√≠a</h2>
        <div class="chart-container chart-medium">
          <canvas #categoriasChart></canvas>
        </div>
        <div *ngIf="estadisticasCategorias().length === 0" class="empty-state">
          No hay productos registrados
        </div>
      </section>

      <!-- Productos m√°s vendidos -->
      <section class="chart-section full-width">
        <h2>‚≠ê Top 5 Productos M√°s Vendidos</h2>
        <div class="top-products">
          <div *ngFor="let producto of productosMasVendidos(); let i = index" class="top-product-item">
            <div class="rank">{{ i + 1 }}</div>
            <div class="product-details">
              <h4>{{ producto.nombre }}</h4>
              <p>{{ producto.cantidad }} unidades vendidas</p>
              <p class="revenue">{{ formatearMoneda(producto.ingresos) }}</p>
            </div>
          </div>
          <div *ngIf="productosMasVendidos().length === 0" class="empty-state">
            No hay datos de ventas disponibles
          </div>
        </div>
      </section>

      <!-- Productos con stock bajo -->
      <section class="chart-section full-width" *ngIf="productosStockBajo().length > 0">
        <h2>‚ö†Ô∏è Productos con Stock Bajo</h2>
        <div class="low-stock-table">
          <table>
            <thead>
              <tr>
                <th>Producto</th>
                <th>Categor√≠a</th>
                <th>Stock Actual</th>
                <th>Precio</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let producto of productosStockBajo()">
                <td>{{ producto.Titulo }}</td>
                <td><span class="badge-categoria">{{ producto.Categoria }}</span></td>
                <td>
                  <span class="stock-badge" [class.critical]="producto.Stock < 5">
                    {{ producto.Stock }} unidades
                  </span>
                </td>
                <td>{{ formatearMoneda(producto.Precio) }}</td>
              </tr>
            </tbody>
          </table>
        </div>
      </section>

      <!-- Calificaciones y Rese√±as -->
      <section class="chart-section full-width">
        <h2>‚≠ê Calificaciones y Rese√±as</h2>
        
        <div class="ratings-stats">
          <div class="rating-stat-card">
            <div class="stat-icon">üìä</div>
            <div class="stat-info">
              <div class="stat-value">{{ totalReviews() }}</div>
              <div class="stat-label">Total de Rese√±as</div>
            </div>
          </div>
          
          <div class="rating-stat-card">
            <div class="stat-icon">‚≠ê</div>
            <div class="stat-info">
              <div class="stat-value">{{ promedioGeneralRating().toFixed(1) }}</div>
              <div class="stat-label">Promedio General</div>
            </div>
          </div>
          
          <div class="rating-stat-card">
            <div class="stat-icon">üèÜ</div>
            <div class="stat-info">
              <div class="stat-value">{{ productosMejorCalificados().length }}</div>
              <div class="stat-label">Productos Calificados</div>
            </div>
          </div>
        </div>

        <div class="top-rated-products" *ngIf="productosMejorCalificados().length > 0">
          <h3>Top 5 Productos Mejor Calificados</h3>
          <div class="rated-products-list">
            <div class="rated-product-item" *ngFor="let producto of productosMejorCalificados(); let i = index">
              <div class="rank-number">#{{ i + 1 }}</div>
              <div class="product-info">
                <div class="product-name">{{ producto.Titulo }}</div>
                <div class="product-rating">
                  <app-star-rating 
                    [rating]="producto.Rating_Promedio" 
                    [readonly]="true"
                    size="small">
                  </app-star-rating>
                  <span class="rating-text">{{ producto.Rating_Promedio.toFixed(1) }}</span>
                </div>
              </div>
              <div class="product-reviews">
                <span class="reviews-count">{{ producto.Total_Reviews }} {{ producto.Total_Reviews === 1 ? 'rese√±a' : 'rese√±as' }}</span>
              </div>
            </div>
          </div>
          <div *ngIf="productosMejorCalificados().length === 0" class="empty-state">
            No hay productos calificados todav√≠a
          </div>
        </div>
      </section>
    </div>
  </div>
</div>
